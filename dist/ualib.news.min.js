function apiToJsTime(a){var b;return b=a+21600,b*=1e3}function correctEventTime(a){const b=60*(new Date).getTimezoneOffset()*1e3;return apiToJsTime(a)+b-216e5}angular.module("ualib.news.templates",["news-item/event-card.tpl.html","news-item/news-card.tpl.html","news-item/news-item.tpl.html","news/news-list.tpl.html","today/news-today.tpl.html"]),angular.module("news-item/event-card.tpl.html",[]).run(["$templateCache",function(a){a.put("news-item/event-card.tpl.html",'<a ng-href="{{newsCard.event.localist_url}}" target="_new" class="media news-card">\n    <div class="media-left">\n        <div class="cal-icon">\n            <div class="cal-month">{{newsCard.event.first_date | date:\'MMM\'}}</div>\n            <div class="cal-day">{{newsCard.event.first_date | date:\'d\'}}</div>\n        </div>\n    </div>\n    <div class="media-body">\n        <h3 class="h4 media-heading" ng-bind-html="newsCard.event.title | truncate:50:\'...\':true"></h3>\n        <p ng-bind-html="newsCard.event.description_text | truncate:150:\'...\':true"></p>\n    </div>\n</a>\n')}]),angular.module("news-item/news-card.tpl.html",[]).run(["$templateCache",function(a){a.put("news-item/news-card.tpl.html",'<a ng-href="#/news-exhibits/{{newsCard.link}}" class="media news-card">\n    <div class="media-body">\n        <h3 class="h4 media-heading">\n            <span ng-bind-html="newsCard.title | truncate:50:\'...\':true"></span>\n        </h3>\n        <div class="details-context" ng-if="(newsCard.activeFrom != newsCard.activeUntil && newsCard.type != 0)">\n            {{newsCard.activeFrom | date:mediumDate}} - {{newsCard.activeUntil | date:mediumDate}}\n        </div>\n        <div class="details-context" ng-if="(newsCard.type == 0)">\n            {{newsCard.created | date:mediumDate}}\n        </div>\n        <p ng-bind-html="newsCard.blurb | truncate:150:\'...\':true"></p>\n    </div>\n</a>')}]),angular.module("news-item/news-item.tpl.html",[]).run(["$templateCache",function(a){a.put("news-item/news-item.tpl.html",'<div class="jumbotron-header">\n    <div class="jumbotron">\n        <div class="container">\n            <div class="row">\n                <div class="col-sm-12">\n                    <ol class="breadcrumb" typeof="BreadcrumbList" vocab="http://schema.org/">\n                        <li><a title="Go to The University of Alabama Libraries." href="/#/home" class="home">The University of Alabama Libraries</a></li>\n                        <li><a title="Go to News." href="/#/news-exhibits" class="post post-page">News</a></li>\n                        <li><a title="Go to news article." href="" class="post post-page">{{newsItem.title | truncate: 30: \'...\': true}}</a></li>\n                    </ol>\n                </div>\n            </div>\n            <div class="row">\n                <div class="col-sm-7">\n                    <h1>News &amp; Exhibits</h1>\n                </div>\n                <div class="col-sm-5">\n                    <div class="well">\n                        <p class="lead">Looking for upcoming events in the University Libraries?</p>\n                        <a href="https://calendar.ua.edu/department/university_libraries/" class="btn btn-primary btn-primary-dark" target="_new">View event calendar <span class="fa fa-external-link"></span></a>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div class="container">\n    <div class="page-header">\n        <h2>{{newsItem.title}}</h2>\n    </div>\n    <div class="row">\n        <div class="col-md-4 col-md-push-8">\n            <div class="well" ng-if="newsItem.contactName">\n                <h3 class="h4">For more information contact</h3>\n                <ul class="fa-ul">\n                    <li><span class="fa fa-user fa-li"></span>{{newsItem.contactName}}</li>\n                    <li><span class="fa fa-phone fa-li"></span>{{newsItem.contactPhone}}</li>\n                    <li><span class="fa fa-envelope fa-li"></span>{{newsItem.contactEmail}}</li>\n                </ul>\n            </div>\n            <a href="#/news-exhibits" class="btn btn-default"><span class="fa fa-reply"></span> See all news &amp; exhibits</a>\n        </div>\n        <div class="col-md-8 col-md-pull-4">\n            <div class="text-center news-carousel-container-small" ng-if="newsItem.images.length > 0">\n                <div class="layer text-center image-holder" ng-repeat="img in newsItem.images track by $index">\n                    <img class="news-image" ng-src="{{img.src}}" ng-click="enlargeImages(true, $index)" ng-if="newsItem.altText != null" ng-attr-alt="{{newsItem.altText}}" />\n                    <img class="news-image" ng-src="{{img.src}}" ng-click="enlargeImages(true, $index)" ng-if="newsItem.altText == null" />\n                </div>\n            </div>\n            <h5 class="text-muted">\n                <span>Created on {{newsItem.created | date:mediumDate}}</span>\n            </h5>\n            <p class="text-justify" ng-bind-html="newsItem.description"></p>\n        </div>\n    </div>\n</div>\n')}]),angular.module("news/news-list.tpl.html",[]).run(["$templateCache",function(a){a.put("news/news-list.tpl.html",'<div class="jumbotron-header">\n    <div class="jumbotron">\n        <div class="container">\n            <div class="row">\n                <div class="col-sm-12">\n                    <ol class="breadcrumb" typeof="BreadcrumbList" vocab="http://schema.org/">\n                        <li><a title="Go to The University of Alabama Libraries." href="/#/home" class="home">The University of Alabama Libraries</a></li>\n                        <li><a title="Go to News." href="/#/news-exhibits" class="post post-page">News</a></li>\n                    </ol>\n                </div>\n            </div>\n            <div class="row">\n                <div class="col-sm-7">\n                    <h1>News &amp; Exhibits</h1>\n                </div>\n                <div class="col-sm-5">\n                    <div class="well">\n                        <p class="lead">Looking for upcoming events in the University Libraries?</p>\n                        <a href="https://calendar.ua.edu/department/university_libraries/" class="btn btn-primary btn-primary-dark" target="_new">View event calendar <span class="fa fa-external-link"></span></a>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n\n<div class="container">\n    <div class="row">\n        <div class="col-md-3 col-md-push-9 hidden-xs">\n            <h2 class="h4">Filters</h2>\n            <form class="facets-form">\n                <div class="form-group">\n                    <h3 class="h5" id="filterNews">Search news and exhibits</h3>\n                    <input type="text" aria-labelledby="filterNews" class="form-control" ng-model="newsFilters.search" placeholder="Keyword search">\n                </div>\n            </form>\n        </div>\n        <div class="col-md-9 col-md-pull-3">\n\n            <div class="media animate-repeat" ng-repeat="item in news | filter:{type: newsFilters.type}\n                                                                  | filter:newsFilters.search\n                                                                  | orderBy:[\'-sticky\',\'-created\']">\n                <div class="media-left hidden-sm hidden-xs">\n                    <span class="news-list-tb" ng-class="{img: item.tb}">\n                        <img class="media-object" ng-src="{{item.tb}}" alt={{item.altText}} ng-if="item.tb" />\n                        <span class="media-object"\n                          ng-if="item.type == 0 && !item.tb"><span class="fa fa-newspaper-o"></span></span>\n                        <span class="media-object"\n                          ng-if="item.type == 1 && !item.tb"><span class="fa fa-calendar"></span></span>\n                    </span>\n                </div>\n                <div class="media-body">\n                    <h2 class="h3 media-heading">\n                        <a ng-href="#/news-exhibits/{{item.link}}" ng-bind-html="item.title | highlight:newsFilters.search"></a>\n                    </h2>\n\n                    <h3 class="h5 text-muted" ng-if="item.type > 0">Exhibit {{item.activeFrom | date:mediumDate}} - {{item.activeUntil | date:mediumDate}}</h5>\n                    <h3 class="h5 text-muted" ng-if="item.type < 1">Created on {{item.created | date:mediumDate}}</h5>\n                    <p class="text-justify">\n                    <span ng-bind-html="item.blurb | highlight:newsFilters.search">\n                    </span>\n                    </p>\n                </div>\n            </div>\n\n            <div class="text-center">\n                <pagination total-items="filteredNews.length" ng-model="soft.page" max-size="10" class="pagination-sm" boundary-links="true" items-per-page="soft.perPage" ng-change="update()" ng-if="filteredNews.length > soft.perPage"></pagination>\n            </div>\n\n            <div class="alert alert-warning text-center" role="alert" ng-show="news.length < 1">\n                <span class="h2">\n                    No\n                    <span ng-show="newsFilters.type == \'\'">News or Exhibits</span>\n                    <span ng-show="newsFilters.type == \'0\'">News</span>\n                    <span ng-show="newsFilters.type == \'1\'">Exhibits</span>\n                    match the search "<strong>{{newsFilters.search}}</strong>"</span>\n                </span>\n            </div>\n        </div>\n\n\n\n    </div>\n</div>')}]),angular.module("today/news-today.tpl.html",[]).run(["$templateCache",function(a){a.put("today/news-today.tpl.html",'<div class="row" ng-controller="NewsTodayCtrl">\n\n    <a news-card="item" ng-repeat="item in news">\n    </a>\n\n    <masonry>\n        <div class="masonry-brick">\n            <a news-card="item" ng-repeat="item in news">\n            </a>\n        </div>\n        <div class="masonry-brick">\n            <a news-card="item" ng-repeat="item in events">\n            </a>\n        </div>\n        <div class="masonry-brick">\n            <div class="hours-list"></div>\n        </div>\n    </masonry>\n\n</div>')}]),angular.module("ualib.news",["ngRoute","ngResource","ngSanitize","ngAnimate","angular.filter","duScroll","ui.bootstrap","angular-carousel","ualib.ui","ualib.news.templates"]),angular.module("ualib.news").factory("ualibEventFactory",["$resource",function(a){function b(a){return JSON.parse(a).events}return a("https://calendar.ua.edu/api/2/events",{days:365,group_id:32423144336963,distinct:!0},{today:{method:"GET",params:{pp:4},isArray:!0,transformResponse:b,cache:!0}})}]),angular.module("ualib.news").factory("ualibNewsFactory",["$resource","$sce","$filter","$http",function(a,b,c,d){function e(a){return a=c("unique")(a,"title"),a.map(function(a){var b=a;return b.type=1,null!==a.activeFrom?(b.activeFrom=new Date(correctEventTime(a.activeFrom)),console.log(b.activeFrom)):b.activeFrom=null,null!==a.activeUntil?b.activeUntil=new Date(correctEventTime(a.activeUntil)):b.activeUntil=null,null===b.activeFrom&&null===b.activeUntil&&(b.type=0),b.created=new Date(1e3*a.created),b.hasOwnProperty("link")||(b.link=c("slugify")(b.title)),b.hasOwnProperty("blurb")||(b.blurb=c("stripTags")(b.description),b.blurb=c("truncate")(b.blurb,250,"...",!0)),b})}function f(a,b){return a=angular.isArray(a)?a:[a],a.concat(b)}return a("//wwwdev2.lib.ua.edu/newsApp/api/:news",{},{get:{method:"GET",params:{news:"archive"},cache:!0,transformResponse:f(d.defaults.transformResponse,function(a){var b=angular.fromJson(a);return formatted=e(b.news),b.news=formatted,b})},today:{method:"GET",params:{news:"today"},cache:!0,transformResponse:f(d.defaults.transformResponse,function(a){var b=angular.fromJson(a);for(var c in b)angular.isArray(b[c])&&(b[c]=e(b[c]));return b})}})}]),angular.module("ualib.news").config(["$routeProvider",function(a){a.when("/news-exhibits/:link",{reloadOnSearch:!1,resolve:{newsItem:["ualibNewsFactory",function(a){return a.get({news:"archive"},function(a){return a},function(a,b,c,d){console.log("ERROR: news item"),console.log({data:a,status:b,headers:c,config:d})})}]},templateUrl:"news-item/news-item.tpl.html",controller:"newsItemCtrl"})}]).controller("newsItemCtrl",["$scope","newsItem","$routeParams","$document","$q",function(a,b,c,d,e){function f(a,b,c,d){b=b||0,c=c||a.images.length,d=d||e.defer(),c<1&&d.resolve(a);var g=new Image;return g.onload=function(){this.styles="url("+this.src+")",this.width/this.height<1.3&&(this.isPortrait=!0,console.log("PORTRAIT TRUE!")),a.images[b]=this,b+1===c?d.resolve(a):(b++,f(a,b,c,d))},g.src=a.images[b],d.promise}d.duScrollTo(0,30,500,function(a){return--a*a*a+1}),a.showEnlarged=!1,a.curImage=0;var g;a.enlargeImages=function(b,c){b?(a.showEnlarged=!0,a.isLocked=!0,a.curEnlImage=c,g||(g=angular.element(document.querySelectorAll(".rn-carousel-controls, .rn-carousel-indicator, .fullsize-img")),g.bind("click",function(a){a.preventDefault(),a.stopPropagation()}))):(a.showEnlarged=!1,a.isLocked=!1)},a.setCurEnlImage=function(b){a.curEnlImage=b},b.$promise.then(function(b){for(var d=null,e=0,g=b.news.length;e<g&&(d=b.news[e],!d.link||d.link!==c.link);e++);f(d).then(function(b){a.newsItem=b,""===a.newsItem.altText?(console.log("Alt text empty!"),console.log(a.newsItem)):console.log(a.newsItem)})}),a.$on("$destroy",function(){g&&g.unbind("click")})}]).directive("newsCard",[function(){return{restrict:"A",replace:!0,scope:{newsCard:"=?",newsFilters:"=?",newsType:"@"},templateUrl:function(a,b){return"news-item/"+(angular.isDefined(b.newsType)?b.newsType:"news")+"-card.tpl.html"}}}]),angular.module("ualib.news").config(["$routeProvider",function(a){a.when("/news-exhibits/",{reloadOnSearch:!1,resolve:{newsList:["ualibNewsFactory",function(a){return a.get({news:"archive"},function(a){return a},function(a,b,c,d){console.log("ERROR: news"),console.log({data:a,status:b,headers:c,config:d})})}]},templateUrl:"news/news-list.tpl.html",controller:"newsListCtrl"})}]).controller("newsListCtrl",["$scope","$location","newsList",function(a,b,c){function d(){var c=b.search();for(var d in c)a.newsFilters.hasOwnProperty(d)&&(a.newsFilters[d]=c[d])}function e(){var c=a.newsFilters,d=b.search();for(var e in c)angular.isDefined(c[e])&&""!==c[e]?b.search(e,c[e]):d.hasOwnProperty(e)&&b.search(e,null)}var f;a.newsFilters={sort:"created",type:"",search:""},c.$promise.then(function(b){a.news=b.news,d(),f=a.$watch("newsFilters",function(a,b){a!==b&&e()},!0)}),a.$on("$destroy",function(){f()})}]),angular.module("ualib.news").controller("NewsTodayCtrl",["$scope","$filter","ualibNewsFactory","ualibEventFactory",function(a,b,c,d){Promise.all([c.today().$promise.then(function(b){a.news=b.news}),d.today().$promise.then(function(b){a.events=b})]).then(function(){a.newsOverflow=a.news.length+a.events.length>3})}]);